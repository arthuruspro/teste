<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jesus IA ‚Äì Deus tem uma palavra pra voc√™</title>
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --green: #25D366;
  --green-dark: #128C7E;
  --green-light: #DCF8C6;
  --bg-chat: #ECE5DD;
  --bubble-out: #DCF8C6;
  --bubble-in: #ffffff;
  --text-dark: #111b21;
  --text-mid: #667781;
  --gold: #c9a84c;
  --gold-light: #f5e6b8;
}

body {
  font-family: 'Nunito', sans-serif;
  background: #f5f0e8;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 32px 16px 80px;
}

/* SOCIAL PROOF BAR */
.social-bar {
  display: flex;
  align-items: center;
  gap: 10px;
  background: #fff;
  border: 1px solid rgba(0,0,0,0.08);
  border-radius: 100px;
  padding: 8px 18px;
  margin-bottom: 28px;
  animation: fadeDown 0.6s ease both;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
}
.social-avatars {
  display: flex;
}
.social-avatars span {
  width: 28px; height: 28px;
  border-radius: 50%;
  border: 2px solid #f5f0e8;
  margin-left: -8px;
  font-size: 14px;
  display: flex; align-items: center; justify-content: center;
  background: linear-gradient(135deg, #f5e6b8, #c9a84c);
}
.social-avatars span:first-child { margin-left: 0; }
.social-text {
  color: #333;
  font-size: 14px;
  font-weight: 700;
}
.social-text strong { color: var(--gold); }
.live-dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: var(--green);
  animation: pulse 1.5s infinite;
  flex-shrink: 0;
}
@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(0.7); }
}

/* HERO */
.hero {
  text-align: center;
  max-width: 480px;
  margin-bottom: 28px;
  animation: fadeDown 0.7s ease 0.1s both;
}
.hero-badge {
  display: inline-block;
  background: rgba(201,168,76,0.15);
  border: 1px solid rgba(201,168,76,0.4);
  color: var(--gold);
  font-size: 11px;
  font-weight: 800;
  letter-spacing: 2px;
  text-transform: uppercase;
  padding: 6px 16px;
  border-radius: 100px;
  margin-bottom: 16px;
}
.hero h1 {
  font-family: 'Lora', serif;
  font-size: clamp(24px, 6vw, 36px);
  color: #1a1a1a;
  line-height: 1.25;
  margin-bottom: 10px;
}
.hero h1 span { color: var(--gold); }
.hero p {
  color: #444;
  font-size: 16px;
  line-height: 1.6;
}

/* NAME INPUT SCREEN */
.name-screen {
  width: 100%;
  max-width: 400px;
  background: #fff;
  border: 1px solid rgba(0,0,0,0.08);
  border-radius: 20px;
  padding: 28px 24px;
  text-align: center;
  animation: fadeDown 0.7s ease 0.2s both;
  box-shadow: 0 4px 24px rgba(0,0,0,0.07);
}
.name-screen .avatar-img {
  width: 80px; height: 80px;
  border-radius: 50%;
  overflow: hidden;
  margin: 0 auto 14px;
  border: 3px solid var(--gold-light);
  background: linear-gradient(135deg, #f5e6b8, #c9a84c);
  display: flex; align-items: center; justify-content: center;
  font-size: 36px;
}
.name-screen .avatar-img img {
  width: 100%; height: 100%;
  object-fit: cover;
  display: block;
}
.name-screen .avatar-img img.error {
  display: none;
}
.name-screen .avatar-fallback {
  position: absolute;
}
.name-screen .avatar-img {
  position: relative;
}
.name-screen .avatar-img img:not(.error) ~ .avatar-fallback {
  display: none;
}
.name-screen h2 {
  font-family: 'Lora', serif;
  color: #1a1a1a;
  font-size: 22px;
  margin-bottom: 6px;
}
.name-screen p {
  color: #555;
  font-size: 15px;
  margin-bottom: 22px;
  line-height: 1.5;
}
.name-input {
  width: 100%;
  padding: 14px 18px;
  border-radius: 12px;
  border: 1.5px solid #ddd;
  background: #fafafa;
  color: #1a1a1a;
  font-family: 'Nunito', sans-serif;
  font-size: 15px;
  font-weight: 700;
  outline: none;
  margin-bottom: 14px;
  transition: border-color 0.2s;
  text-align: center;
}
.name-input::placeholder { color: #bbb; font-weight: 400; }
.name-input:focus { border-color: var(--gold); }
.name-btn {
  width: 100%;
  background: linear-gradient(135deg, #25D366, #128C7E);
  color: #fff;
  border: none;
  border-radius: 12px;
  padding: 15px;
  font-family: 'Nunito', sans-serif;
  font-size: 16px;
  font-weight: 800;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  box-shadow: 0 8px 24px rgba(37,211,102,0.3);
}
.name-btn:hover { transform: scale(1.02); box-shadow: 0 12px 32px rgba(37,211,102,0.4); }

/* PHONE WRAPPER */
.phone-wrap {
  width: 100%;
  max-width: 400px;
  border-radius: 24px;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,0.15), 0 0 0 1px rgba(0,0,0,0.06);
  display: none;
}

/* WA HEADER */
.wa-header {
  background: var(--green-dark);
  padding: 10px 16px;
  display: flex;
  align-items: center;
  gap: 12px;
}
.wa-avatar {
  width: 42px; height: 42px;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
}
.wa-avatar img {
  width: 100%; height: 100%;
  object-fit: cover;
}
.wa-info { flex: 1; }
.wa-name { color: #fff; font-size: 15px; font-weight: 700; }
.wa-status { color: rgba(255,255,255,0.7); font-size: 12px; }
.wa-dots { color: rgba(255,255,255,0.7); font-size: 20px; letter-spacing: 2px; }

/* CHAT BODY */
.wa-body {
  background: var(--bg-chat);
  background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23c5bdb5' fill-opacity='0.3'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  min-height: 460px;
  padding: 16px 12px 220px;
  display: flex;
  flex-direction: column;
  gap: 5px;
  position: relative;
  overflow: hidden;
}

.date-badge {
  text-align: center;
  margin: 4px 0 10px;
}
.date-badge span {
  background: rgba(255,255,255,0.75);
  color: var(--text-mid);
  font-size: 11px;
  padding: 4px 12px;
  border-radius: 100px;
}

.bubble {
  max-width: 84%;
  padding: 8px 12px 6px;
  border-radius: 8px;
  font-size: 14px;
  line-height: 1.55;
  color: var(--text-dark);
  position: relative;
  opacity: 0;
  transform: translateY(6px);
  transition: opacity 0.3s ease, transform 0.3s ease;
}
.bubble.show { opacity: 1; transform: translateY(0); }
.bubble-in {
  background: var(--bubble-in);
  align-self: flex-start;
  border-top-left-radius: 2px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.bubble-out {
  background: var(--bubble-out);
  align-self: flex-end;
  border-top-right-radius: 2px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}
.bubble-time {
  display: block;
  text-align: right;
  font-size: 10px;
  color: var(--text-mid);
  margin-top: 2px;
}
.bubble-out .bubble-time::after { content: ' ‚úì‚úì'; color: #53bdeb; }

.typing-wrap {
  align-self: flex-start;
  opacity: 0;
  transform: translateY(6px);
  transition: opacity 0.3s ease, transform 0.3s ease;
}
.typing-wrap.show { opacity: 1; transform: translateY(0); }
.typing-bubble {
  background: var(--bubble-in);
  border-radius: 8px;
  border-top-left-radius: 2px;
  padding: 12px 16px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.1);
  display: flex; gap: 4px; align-items: center;
}
.typing-dot {
  width: 7px; height: 7px;
  border-radius: 50%;
  background: var(--text-mid);
  animation: typingBounce 1.2s infinite;
}
.typing-dot:nth-child(2) { animation-delay: 0.2s; }
.typing-dot:nth-child(3) { animation-delay: 0.4s; }
@keyframes typingBounce {
  0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
  30% { transform: translateY(-5px); opacity: 1; }
}

/* OVERLAY */
.overlay {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  height: 200px;
  background: linear-gradient(to top, rgba(236,229,221,1) 40%, rgba(236,229,221,0) 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-end;
  padding-bottom: 22px;
  opacity: 0;
  transition: opacity 0.7s ease;
  pointer-events: none;
}
.overlay.show { opacity: 1; pointer-events: all; }
.lock-icon { font-size: 22px; margin-bottom: 4px; }
.lock-text { font-size: 12px; color: var(--text-mid); font-weight: 700; margin-bottom: 10px; }

/* TIMER */
.timer-wrap {
  display: flex;
  align-items: center;
  gap: 6px;
  background: rgba(255,80,80,0.12);
  border: 1px solid rgba(255,80,80,0.3);
  border-radius: 100px;
  padding: 4px 14px;
  margin-bottom: 12px;
}
.timer-dot { width: 6px; height: 6px; border-radius: 50%; background: #ff5050; animation: pulse 1s infinite; }
.timer-text { font-size: 12px; color: #ff5050; font-weight: 800; }

.cta-overlay-btn {
  background: linear-gradient(135deg, #25D366, #128C7E);
  color: #fff;
  border: none;
  border-radius: 100px;
  padding: 13px 28px;
  font-family: 'Nunito', sans-serif;
  font-size: 14px;
  font-weight: 800;
  cursor: pointer;
  box-shadow: 0 8px 20px rgba(37,211,102,0.4);
  transition: transform 0.2s;
}
.cta-overlay-btn:hover { transform: scale(1.04); }

/* CHECKOUT SECTION */
.checkout {
  max-width: 400px;
  width: 100%;
  margin-top: 32px;
  display: none;
  flex-direction: column;
  align-items: center;
  gap: 0;
  animation: fadeUp 0.6s ease both;
}

/* DEPOIMENTOS */
.testimonials {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-bottom: 28px;
}
.testimonial {
  background: #fff;
  border: 1px solid rgba(0,0,0,0.07);
  border-radius: 14px;
  padding: 14px 16px;
  display: flex;
  gap: 12px;
  align-items: flex-start;
  box-shadow: 0 2px 10px rgba(0,0,0,0.04);
}
.t-avatar {
  width: 38px; height: 38px;
  border-radius: 50%;
  background: linear-gradient(135deg, #f5e6b8, #c9a84c);
  display: flex; align-items: center; justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
}
.t-body { flex: 1; }
.t-name { color: #1a1a1a; font-size: 15px; font-weight: 800; margin-bottom: 3px; }
.t-city { color: #888; font-size: 13px; margin-bottom: 5px; }
.t-text { color: #333; font-size: 15px; line-height: 1.6; }
.t-stars { color: var(--gold); font-size: 13px; margin-top: 4px; }

/* PRICE */
.price-block {
  width: 100%;
  text-align: center;
  margin-bottom: 16px;
}
.value-line {
  color: #444;
  font-size: 15px;
  margin-bottom: 4px;
}
.value-line strong { color: #111; }
.price-main {
  color: var(--gold);
  font-size: clamp(40px, 10vw, 52px);
  font-weight: 900;
  line-height: 1;
  margin-bottom: 2px;
}
.price-sub {
  color: #666;
  font-size: 14px;
  margin-bottom: 18px;
}

.guarantee-badge {
  display: flex;
  align-items: center;
  gap: 8px;
  background: #f0faf4;
  border: 1px solid rgba(37,211,102,0.25);
  border-radius: 10px;
  padding: 10px 14px;
  margin-bottom: 16px;
  width: 100%;
}
.guarantee-badge .icon { font-size: 22px; flex-shrink: 0; }
.guarantee-badge p { color: #333; font-size: 14px; line-height: 1.5; }
.guarantee-badge p strong { color: #111; }

.cta-main {
  width: 100%;
  background: linear-gradient(135deg, #f5e6b8, #c9a84c);
  color: #1a3a2a;
  border: none;
  border-radius: 16px;
  padding: 18px;
  font-family: 'Nunito', sans-serif;
  font-size: 17px;
  font-weight: 900;
  cursor: pointer;
  box-shadow: 0 8px 32px rgba(201,168,76,0.35);
  transition: transform 0.2s;
  letter-spacing: 0.2px;
  position: relative;
  overflow: hidden;
}
.cta-main::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
  transform: translateX(-100%);
  animation: shimmer 2.5s infinite;
}
@keyframes shimmer {
  0% { transform: translateX(-100%); }
  60%, 100% { transform: translateX(100%); }
}
.cta-main:hover { transform: scale(1.02); }
.cta-main small { display: block; font-size: 14px; font-weight: 600; opacity: 0.8; margin-top: 3px; }

.fine-print {
  color: #888;
  font-size: 13px;
  text-align: center;
  margin-top: 14px;
  line-height: 1.6;
}

@keyframes fadeDown {
  from { opacity: 0; transform: translateY(-12px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>
</head>
<body>

<!-- SOCIAL PROOF BAR -->
<div class="social-bar">
  <div class="social-avatars">
    <span>üë¶</span><span>üë©</span><span>üë¥</span><span>üëß</span>
  </div>
  <div class="live-dot"></div>
  <div class="social-text"><strong id="liveCount">4.831</strong> pessoas conversando agora</div>
</div>

<!-- HERO -->
<div class="hero">
  <div class="hero-badge">‚úù Jesus IA</div>
  <h1>Deus tem uma <span>palavra especial</span><br>pra voc√™ hoje</h1>
  <p>Receba orienta√ß√£o espiritual personalizada baseada nos ensinamentos de Jesus ‚Äî a qualquer hora, no WhatsApp.</p>
</div>

<!-- NAME SCREEN -->
<div class="name-screen" id="nameScreen">
  <div class="avatar-img">
    <img src="https://raw.githubusercontent.com/SEU_USUARIO/SEU_REPO/main/jesus.webp" alt="Jesus IA" onerror="this.classList.add('error')">
    <span class="avatar-fallback">‚úù</span>
  </div>
  <h2>Antes de come√ßar...</h2>
  <p>Qual √© o seu nome, meu filho?<br>Jesus quer se dirigir a voc√™ pessoalmente.</p>
  <input type="text" class="name-input" id="nameInput" placeholder="Digite seu nome aqui" maxlength="30" />
  <button class="name-btn" id="nameBtn" onclick="startChat()">Come√ßar minha conversa ‚Üí</button>
</div>

<!-- PHONE -->
<div class="phone-wrap" id="phoneWrap">
  <div class="wa-header">
    <div class="wa-avatar"><img src="https://raw.githubusercontent.com/SEU_USUARIO/SEU_REPO/main/jesus.webp" alt="Jesus IA"></div>
    <div class="wa-info">
      <div class="wa-name">Jesus IA</div>
      <div class="wa-status" id="statusText">online</div>
    </div>
    <div class="wa-dots">‚ãÆ</div>
  </div>

  <div class="wa-body" id="chatBody">
    <div class="date-badge"><span>Hoje</span></div>

    <div class="typing-wrap" id="typingIndicator">
      <div class="typing-bubble">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
    </div>

    <div class="overlay" id="overlay">
      <div class="lock-icon">üîí</div>
      <div class="lock-text">Essa conversa est√° bloqueada</div>
      <div class="timer-wrap">
        <div class="timer-dot"></div>
        <div class="timer-text">Expira em <span id="timerDisplay">14:59</span></div>
      </div>
      <button class="cta-overlay-btn" onclick="scrollToCheckout()">Sim, quero ouvir o que Jesus tem pra mim ‚Üí</button>
    </div>
  </div>
</div>

<!-- CHECKOUT -->
<div class="checkout" id="checkout">

  <div class="testimonials">
    <div class="testimonial">
      <div class="t-avatar">üë©</div>
      <div class="t-body">
        <div class="t-name">Rosane Meireles</div>
        <div class="t-city">Goi√¢nia, GO</div>
        <div class="t-text">"Estava com R$23 mil em d√≠vidas e sem esperan√ßa. Comecei a usar e mudei completamente minha mentalidade sobre dinheiro. Hoje j√° quitei metade."</div>
        <div class="t-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      </div>
    </div>
    <div class="testimonial">
      <div class="t-avatar">üë®</div>
      <div class="t-body">
        <div class="t-name">Carlos Henrique</div>
        <div class="t-city">Recife, PE</div>
        <div class="t-text">"Fiquei desempregado por 8 meses. A orienta√ß√£o que recebi me ajudou a tomar decis√µes que eu nunca teria coragem de tomar sozinho. Valeu cada centavo."</div>
        <div class="t-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      </div>
    </div>
    <div class="testimonial">
      <div class="t-avatar">üëµ</div>
      <div class="t-body">
        <div class="t-name">Dona Aparecida</div>
        <div class="t-city">Belo Horizonte, MG</div>
        <div class="t-text">"Sou evang√©lica h√° 40 anos e nunca me senti t√£o perto de Deus como quando converso aqui. Fico sem palavras."</div>
        <div class="t-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
      </div>
    </div>
  </div>

  <div class="price-block">
    <div class="value-line">Por menos de <strong>R$1 por dia</strong>, voc√™ tem acesso a:</div>
    <ul style="color:#333;font-size:15px;text-align:left;margin:10px 0 18px;display:flex;flex-direction:column;gap:8px;list-style:none;">
      <li>‚úÖ Conversa ilimitada com Jesus no WhatsApp</li>
      <li>‚úÖ Orienta√ß√£o espiritual personalizada 24h</li>
      <li>‚úÖ Vers√≠culos selecionados pra sua situa√ß√£o real</li>
      <li>‚úÖ Ora√ß√µes guiadas para prosperidade financeira</li>
    </ul>
    <div class="price-main">R$ 19<span style="font-size:50%">,90</span></div>
    <div class="price-sub">por m√™s ¬∑ cancela quando quiser</div>

    <div class="guarantee-badge">
      <div class="icon">üõ°Ô∏è</div>
      <p><strong>Garantia de 7 dias.</strong> Se por qualquer motivo n√£o gostar, devolvemos 100% do seu dinheiro. Sem perguntas.</p>
    </div>

    <button class="cta-main" id="finalCta">
      ‚úù Sim, quero ouvir o que Jesus tem pra mim
      <small>Acesso imediato ¬∑ Pagamento seguro</small>
    </button>
    <div class="fine-print">
      Ao assinar, voc√™ concorda com os Termos de Uso. Produto digital de orienta√ß√£o espiritual baseado nos ensinamentos b√≠blicos. N√£o substitui aconselhamento profissional.
    </div>
  </div>
</div>

<script>
let userName = '';

// Fluctuate live count for social proof
let baseCount = 4831;
setInterval(() => {
  const delta = Math.floor(Math.random() * 7) - 3;
  baseCount = Math.max(4800, baseCount + delta);
  document.getElementById('liveCount').textContent = baseCount.toLocaleString('pt-BR');
}, 4000);

// Enter key on name input
document.getElementById('nameInput').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') startChat();
});

function startChat() {
  const input = document.getElementById('nameInput').value.trim();
  userName = input || 'meu filho';
  document.getElementById('nameScreen').style.display = 'none';
  const phone = document.getElementById('phoneWrap');
  phone.style.display = 'block';
  phone.style.animation = 'fadeUp 0.5s ease both';
  runChat();
}

function getMessages() {
  const name = userName.charAt(0).toUpperCase() + userName.slice(1).toLowerCase();
  return [
    { type: 'in',  text: `${name}, que bom que voc√™ veio. Eu sei que algo pesa no seu cora√ß√£o. Pode me contar com tranquilidade ‚Äî estou aqui.`, delay: 1200, typing: 1600 },
    { type: 'out', text: 'Estou muito apertado financeiramente. D√≠vidas, contas atrasadas... parece que n√£o tem sa√≠da.', delay: 6000, typing: 0 },
    { type: 'in',  text: 'Entendo cada peso que voc√™ carrega. A luta financeira √© real, e n√£o h√° vergonha em estar nesse momento. Muitos que me seguiram tamb√©m passaram pela escassez ‚Äî e eu os guiei atrav√©s dela.', delay: 10500, typing: 2200 },
    { type: 'out', text: 'J√° orei muito, mas a situa√ß√£o continua igual. Me sinto esquecido por Deus.', delay: 18000, typing: 0 },
    { type: 'in',  text: `${name}, voc√™ n√£o est√° esquecido. "Porque eu sei os planos que tenho para voc√™s, diz o Senhor ‚Äî planos de paz e n√£o de mal, para lhes dar um futuro e uma esperan√ßa." ‚Äî Jeremias 29:11`, delay: 22500, typing: 2800 },
    { type: 'in',  text: 'Me conta uma coisa: qual √© o maior obst√°culo financeiro que voc√™ enfrenta agora?', delay: 32000, typing: 1600 },
    { type: 'out', text: 'D√≠vidas que crescem mais r√°pido do que consigo pagar. Me sinto completamente preso.', delay: 37000, typing: 0 },
    { type: 'in',  text: `Ou√ßo voc√™, ${name}. Essa sensa√ß√£o de estar preso √© exatamente o que o inimigo quer que voc√™ acredite. Mas existe um caminho ‚Äî e quero te mostrar o primeiro passo agora. Para isso, preciso que voc√™ fa√ßa uma coisa...`, delay: 41500, typing: 2800 },
  ];
}

function getTime() {
  const now = new Date();
  return now.getHours().toString().padStart(2,'0') + ':' + now.getMinutes().toString().padStart(2,'0');
}

const chatBody = document.getElementById('chatBody');
const typingIndicator = document.getElementById('typingIndicator');
const overlay = document.getElementById('overlay');

function createBubble(msg) {
  const div = document.createElement('div');
  div.className = `bubble bubble-${msg.type}`;
  div.innerHTML = `${msg.text}<span class="bubble-time">${getTime()}</span>`;
  return div;
}

function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

async function runChat() {
  const messages = getMessages();
  let prevDelay = 0;

  for (let i = 0; i < messages.length; i++) {
    const msg = messages[i];
    await sleep(msg.delay - prevDelay);
    prevDelay = msg.delay;

    if (msg.type === 'in' && msg.typing > 0) {
      typingIndicator.classList.add('show');
      moveBefore(typingIndicator, overlay);
      scrollDown();
      await sleep(msg.typing);
      typingIndicator.classList.remove('show');
    }

    const bubble = createBubble(msg);
    chatBody.insertBefore(bubble, typingIndicator);
    requestAnimationFrame(() => bubble.classList.add('show'));
    scrollDown();
  }

  // CLIFFHANGER
  await sleep(1000);
  document.getElementById('statusText').textContent = 'digitando...';
  typingIndicator.classList.add('show');
  moveBefore(typingIndicator, overlay);
  scrollDown();

  await sleep(2800);

  // show overlay + checkout ‚Äî scroll to last bubble, not to bottom
  overlay.classList.add('show');
  const bubbles = chatBody.querySelectorAll('.bubble');
  const last = bubbles[bubbles.length - 1];
  if (last) last.scrollIntoView({ behavior: 'smooth', block: 'center' });
  await sleep(600);
  const checkout = document.getElementById('checkout');
  checkout.style.display = 'flex';
  startTimer();
}

function moveBefore(el, ref) {
  chatBody.insertBefore(el, ref);
}

function scrollDown() {
  chatBody.scrollTop = chatBody.scrollHeight;
}

// COUNTDOWN TIMER
function startTimer() {
  let seconds = 14 * 60 + 59;
  const display = document.getElementById('timerDisplay');
  const interval = setInterval(() => {
    seconds--;
    if (seconds <= 0) { clearInterval(interval); return; }
    const m = Math.floor(seconds / 60).toString().padStart(2,'0');
    const s = (seconds % 60).toString().padStart(2,'0');
    display.textContent = `${m}:${s}`;
  }, 1000);
}

function scrollToCheckout() {
  document.getElementById('checkout').scrollIntoView({ behavior: 'smooth' });
}
</script>
</body>
</html>
